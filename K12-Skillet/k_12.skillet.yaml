# snippets is used to load a full NGFW configuration

# snippet folder name
name: K12 Skillet
# label used for menu selection
label: (Step 3) K12 Skillet
description: K12 Safe Search Skillet baseline configuration for a firewall

type: panos

# grouping of like snippets for dynamic menu creation in pan-cnc
labels:
  service_type: K12_skillet
  collection:
    - Education

# variables used in the configuration templates
# type_hint defines the form field type in pan-cnc
variables:
# this configuration allows you to select what type of Safe Search configuration
# to be used during the configuration build
  - name: SAFE_SEARCH
    description: What type of Safe Search configuration do you want to enable?
    default: 'none'
    type_hint: dropdown
    dd_list:
      - key: 'none'
        value: 'NONE'
      - key: 'SSL Decryption'
        value: 'SSL_DECRYPTION'
      - key: 'DNS Proxy'
        value: 'DNS_PROXY'
      - key: 'Local DNS CNAME'
        value: 'LOCAL_DNS_CNAME'
# option built into the templates to ignore the panw published external dynamic lists security rules
# should ONLY be excluded based on licensing limitations outside of best practices
# when 'yes' (default) will include the EDL rule
  - name: INCLUDE_PAN_EDL
    description: Include the predefined Palo Alto Networks external lists security rules
    default: 'no'
    type_hint: dropdown
    dd_list:
      - key: 'yes'
        value: 'yes'
      - key: 'no'
        value: 'no'
  - name: INCLUDE_COUNTRY_BLOCK
    description: Add rules to permit traffic only from US, Mexico, Canada, and Cloud Providers EDL
    default: 'no'
    type_hint: dropdown
    dd_list:
      - key: 'yes'
        value: 'yes'
      - key: 'no'
        value: 'no'
  - name: SANCTIONED_DNS_01_NAME
    description: Safe Search Sanctioned External DNS Server Name
    default: Google 1
    type_hint: text
  - name: SANCTIONED_DNS_01_IP
    description: Safe Search Sanctioned External DNS Server IP Address
    default: 8.8.8.8/32
    type_hint: text
  - name: SANCTIONED_DNS_02_NAME
    description: Safe Search Sanctioned External DNS Server Name
    default: Google 2
    type_hint: text
  - name: SANCTIONED_DNS_02_IP
    description: Safe Search Sanctioned External DNS Server IP Address
    default: 8.8.4.4/32
    type_hint: text
  - name: LOCAL_DNS_01_NAME
    description: Safe Search Local DNS Server Name
    default: Local DNS 1
    type_hint: text
  - name: LOCAL_DNS_01_IP
    description: Safe Search Local DNS Server IP Address
    default: 192.0.2.1
    type_hint: text
  - name: DNS_PROXY_IP_PRIMARY
    description: Safe Search DNS Proxy Primary DNS Server IP Address
    default: 8.8.8.8
    type_hint: text
  - name: DNS_PROXY_IP_SECONDARY
    description: Safe Search DNS Proxy Secondary DNS Server IP Address
    default: 8.8.4.4
    type_hint: text
  - name: GOOGLE_SAFE_SEARCH_IP
    description: Google Safe Search Server IP
    default: 216.239.38.120
    type_hint: text
  - name: BING_SAFE_SEARCH_IP
    description: Bing Safe Search Server IP
    default: 204.79.197.220
    type_hint: text
  - name: CLOUD_EDL_MICROSOFT
    description: Microsoft Cloud EDL URL
    default: http://192.0.2.1
    type_hint: text
  - name: CLOUD_EDL_AMAZON
    description: Amazon Cloud EDL URL
    default: http://192.0.2.2
    type_hint: text
  - name: CLOUD_EDL_GOOGLE
    description: Google Cloud EDL URL
    default: http://192.0.2.3
    type_hint: text
  - name: CRITICAL_EDUCATION_SITE
    description: Critical Education Site For Decryption Bypass
    default: example.com
    type_hint: text
  - name: TRUST_ZONE_INTERFACE
    description: Trusted Interface reference
    default: ethernet1/2
    type_hint: text
  - name: TRUSTED_INTERFACE_IP
    description: Trusted Interface IP
    default: 192.0.2.100/32
    type_hint: text
  - name: UNTRUST_ZONE_INTERFACE
    description: UnTrusted Interface reference
    default: ethernet1/1
    type_hint: text

# snippets used for api configuration including xpath and element as file name
# files will load in the order listed
snippets:
  - name: address
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/address
    element: |
      <entry name="{{ SANCTIONED_DNS_01_NAME }}">
        <ip-netmask>{{ SANCTIONED_DNS_01_IP }}</ip-netmask>
      </entry>
      <entry name="{{ SANCTIONED_DNS_02_NAME }}">
        <ip-netmask>{{ SANCTIONED_DNS_01_IP }}</ip-netmask>
      </entry>
      <entry name="FW - Trust">
        <ip-netmask>{{ TRUSTED_INTERFACE_IP.split('/')[0] }}/32</ip-netmask>
      </entry>
      <entry name="{{ LOCAL_DNS_01_NAME }}">
        <ip-netmask>{{LOCAL_DNS_01_IP }}</ip-netmask>
      </entry>

  - name: address_group
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/address-group
    element: |
      <entry name="Sanctioned DNS Servers">
        <static>
          <member>{{ SANCTIONED_DNS_01_NAME }}</member>
          <member>{{ SANCTIONED_DNS_02_NAME }}</member>
        </static>
      </entry>
      <entry name="Local DNS Servers">
        <static>
          <member>{{ LOCAL_DNS_01_NAME }}</member>
        </static>
      </entry>

  - name: tag
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/tag
    element: |
      <entry name="Deny">
      	<comments>Deny Rules</comments>
      </entry>

  - name: external_list
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/external-list
    element: |
      <entry name="Cloud Platforms - Microsoft">
      	<type>
      	  <ip>
      		<recurring>
      		  <five-minute/>
      		</recurring>
      		<url>{{ CLOUD_EDL_MICROSOFT }}</url>
      		<description>List of Microsoft Azure hosting IPs</description>
      	  </ip>
      	</type>
        </entry>
        <entry name="Cloud Platforms - Amazon">
      	<type>
      	  <ip>
      		<recurring>
      		  <five-minute/>
      		</recurring>
      		<description>List of Amazon hosted IPs</description>
      		<url>{{ CLOUD_EDL_AMAZON }}</url>
      	  </ip>
      	</type>
        </entry>
        <entry name="Cloud Platforms - Google">
      	<type>
      	  <ip>
      		<recurring>
      		  <five-minute/>
      		</recurring>
      		<description>List of Google hosting IPs</description>
      		<url>{{ CLOUD_EDL_GOOGLE }}</url>
      	  </ip>
      	</type>
        </entry>
        <entry name="Team Cymru Bogons IPv4">
      	<type>
      	  <ip>
      		<url>http://www.team-cymru.org/Services/Bogons/fullbogons-ipv4.txt</url>
      		<recurring>
      		  <hourly/>
      		</recurring>
      		<description>IPv4 addresses that should not be routed across the Internet. Either reserved IP address space or unassigned and may be used for malicious purposes. More information: http://www.team-cymru.com/bogon-reference.html</description>
      	  </ip>
      	</type>
        </entry>
        <entry name="Team Cymru Bogons IPv6">
      	<type>
      	  <ip>
      		<recurring>
      		  <hourly/>
      		</recurring>
      		<url>http://www.team-cymru.org/Services/Bogons/fullbogons-ipv6.txt</url>
      		<description>IPv6 addresses that should not be routed across the Internet. Either reserved IP address space or unassigned and may be used for malicious purposes. More information: http://www.team-cymru.com/bogon-reference.html</description>
      	  </ip>
      	</type>
      </entry>

  - name: interface
    xpath: /config/devices/entry[@name='localhost.localdomain']/network/interface
    element: |
      <ethernet>
        <entry name="ethernet1/1">
          <layer3>
            <ipv6>
              <neighbor-discovery>
                <router-advertisement>
                  <enable>no</enable>
                </router-advertisement>
              </neighbor-discovery>
            </ipv6>
            <ndp-proxy>
              <enabled>no</enabled>
            </ndp-proxy>
            <lldp>
              <enable>no</enable>
            </lldp>
            <dhcp-client/>
          </layer3>
        </entry>
        <entry name="ethernet1/2">
          <layer3>
            <ipv6>
              <neighbor-discovery>
                <router-advertisement>
                  <enable>no</enable>
                </router-advertisement>
              </neighbor-discovery>
            </ipv6>
            <ndp-proxy>
              <enabled>no</enabled>
            </ndp-proxy>
            <lldp>
              <enable>no</enable>
            </lldp>
            <ip>
              <entry name="{{ TRUSTED_INTERFACE_IP }}{{ TRUSTED_INTERFACE_SUBNET }}"/>
            </ip>
          </layer3>
        </entry>
      </ethernet>

  - name: virtual_router
    xpath: /config/devices/entry[@name='localhost.localdomain']/network/virtual-router
    element: |
      <entry name="default">
        <protocol>
          <bgp>
            <enable>no</enable>
            <dampening-profile>
              <entry name="default">
                <cutoff>1.25</cutoff>
                <reuse>0.5</reuse>
                <max-hold-time>900</max-hold-time>
                <decay-half-life-reachable>300</decay-half-life-reachable>
                <decay-half-life-unreachable>900</decay-half-life-unreachable>
                <enable>yes</enable>
              </entry>
            </dampening-profile>
          </bgp>
        </protocol>
        <interface>
          <member>ethernet1/1</member>
          <member>ethernet1/2</member>
        </interface>
      </entry>

  - name: zone
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/zone
    element: |
      <entry name="Untrust">
        <network>
          <layer3>
            <member>{{ UNTRUST_ZONE_INTERFACE }}</member>
          </layer3>
        </network>
      </entry>
      <entry name="Trust">
        <network>
          <layer3>
            <member>{{ TRUST_ZONE_INTERFACE }}</member>
          </layer3>
        </network>
      </entry>

  - name: dns_proxy
    xpath: /config/devices/entry[@name='localhost.localdomain']/network/dns-proxy
    element: |
      <entry name="DNS proxy with Safe Search">
        <cache>
          <max-ttl>
            <enabled>yes</enabled>
            <time-to-live>3600</time-to-live>
          </max-ttl>
          <enabled>yes</enabled>
        </cache>
        <default>
          <primary>{{ DNS_PROXY_IP_PRIMARY }}</primary>
          <secondary>{{ DNS_PROXY_IP_SECONDARY }}</secondary>
        </default>
        <tcp-queries>
          <enabled>no</enabled>
        </tcp-queries>
        <static-entries>
          <entry name="Google 1">
            <address>
              <member>{{ GOOGLE_SAFE_SEARCH_IP }}</member>
            </address>
            <domain>www.google.com</domain>
          </entry>
          <entry name="Google 2">
            <address>
              <member>{{ GOOGLE_SAFE_SEARCH_IP }}</member>
            </address>
            <domain>google.com</domain>
          </entry>
          <entry name="Bing 1">
            <address>
              <member>{{ BING_SAFE_SEARCH_IP }}</member>
            </address>
            <domain>www.bing.com</domain>
          </entry>
          <entry name="Bing 2">
            <address>
              <member>{{ BING_SAFE_SEARCH_IP }}</member>
            </address>
            <domain>bing.com</domain>
          </entry>
        </static-entries>
         {%- if SAFE_SEARCH == "DNS_PROXY" %}
        <enabled>yes</enabled>
         {% else %}
        <enabled>no</enabled>
         {% endif %}
        <interface>
          <member>{{ TRUST_ZONE_INTERFACE }}</member>
        </interface>
      </entry>

  - name: profiles_custom_url_category
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/profiles/custom-url-category
    element: |
      <entry name="Black-List">
        <type>URL List</type>
        <list>
          <member>www.yahoo.com</member>
          <member>*.yahoo.com</member>
        </list>
      </entry>
      <entry name="Approved Search Engines">
        <list>
          <member>google.com</member>
          <member>*.google.com</member>
          <member>bing.com</member>
          <member>*.bing.com</member>
        </list>
        <type>URL List</type>
      </entry>
      <entry name="Blocked Search terms">
        <list>
          <member>*/*+build+a+bomb</member>
          <member>*/*=build+a+bomb</member>
          <member>*/*+test+test</member>
          <member>*/*=test+test</member>
        </list>
        <type>URL List</type>
      </entry>
      <entry name="Critical_Education_Sites">
        <list>
          <member>{{ CRITICAL_EDUCATION_SITE }}</member>
        </list>
        <type>URL List</type>
      </entry>

  - name: profiles_url_filtering
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/profiles/url-filtering
    element: |
      <entry name="Outbound-URL-Sanctioned-Search">
        <credential-enforcement>
          <mode>
            <ip-user/>
          </mode>
          <log-severity>high</log-severity>
      <block>
            <member>abortion</member>
            <member>abused-drugs</member>
            <member>adult</member>
            <member>alcohol-and-tobacco</member>
            <member>auctions</member>
            <member>business-and-economy</member>
            <member>command-and-control</member>
            <member>computer-and-internet-info</member>
            <member>content-delivery-networks</member>
            <member>copyright-infringement</member>
            <member>dating</member>
            <member>dynamic-dns</member>
            <member>educational-institutions</member>
            <member>entertainment-and-arts</member>
            <member>extremism</member>
            <member>financial-services</member>
            <member>gambling</member>
            <member>games</member>
            <member>government</member>
            <member>hacking</member>
            <member>health-and-medicine</member>
            <member>high-risk</member>
            <member>home-and-garden</member>
            <member>hunting-and-fishing</member>
            <member>insufficient-content</member>
            <member>internet-communications-and-telephony</member>
            <member>internet-portals</member>
            <member>job-search</member>
            <member>legal</member>
            <member>low-risk</member>
            <member>malware</member>
            <member>medium-risk</member>
            <member>military</member>
            <member>motor-vehicles</member>
            <member>music</member>
            <member>newly-registered-domain</member>
            <member>news</member>
            <member>not-resolved</member>
            <member>nudity</member>
            <member>online-storage-and-backup</member>
            <member>parked</member>
            <member>peer-to-peer</member>
            <member>personal-sites-and-blogs</member>
            <member>philosophy-and-political-advocacy</member>
            <member>phishing</member>
            <member>private-ip-addresses</member>
            <member>proxy-avoidance-and-anonymizers</member>
            <member>questionable</member>
            <member>real-estate</member>
            <member>recreation-and-hobbies</member>
            <member>reference-and-research</member>
            <member>religion</member>
            <member>search-engines</member>
            <member>sex-education</member>
            <member>shareware-and-freeware</member>
            <member>shopping</member>
            <member>social-networking</member>
            <member>society</member>
            <member>sports</member>
            <member>stock-advice-and-tools</member>
            <member>streaming-media</member>
            <member>swimsuits-and-intimate-apparel</member>
            <member>training-and-tools</member>
            <member>translation</member>
            <member>travel</member>
            <member>unknown</member>
            <member>weapons</member>
            <member>web-advertisements</member>
            <member>web-based-email</member>
            <member>web-hosting</member>
            <member>Black-List</member>
            <member>White-List</member>
          </block>
        </credential-enforcement>
        <log-http-hdr-user-agent>yes</log-http-hdr-user-agent>
        <log-http-hdr-referer>yes</log-http-hdr-referer>
        <log-http-hdr-xff>yes</log-http-hdr-xff>
        <safe-search-enforcement>yes</safe-search-enforcement>
        <allow>
          <member>White-List</member>
        </allow>
        <alert>
          <member>Approved Search Engines</member>
          <member>low-risk</member>
          <member>sex-education</member>
          <member>shareware-and-freeware</member>
        </alert>
        <block>
          <member>Black-List</member>
          <member>Blocked Search terms</member>
          <member>abortion</member>
          <member>abused-drugs</member>
          <member>adult</member>
          <member>alcohol-and-tobacco</member>
          <member>auctions</member>
          <member>command-and-control</member>
          <member>copyright-infringement</member>
          <member>dating</member>
          <member>dynamic-dns</member>
          <member>extremism</member>
          <member>gambling</member>
          <member>games</member>
          <member>hacking</member>
          <member>high-risk</member>
          <member>insufficient-content</member>
          <member>malware</member>
          <member>medium-risk</member>
          <member>newly-registered-domain</member>
          <member>not-resolved</member>
          <member>nudity</member>
          <member>parked</member>
          <member>peer-to-peer</member>
          <member>phishing</member>
          <member>private-ip-addresses</member>
          <member>proxy-avoidance-and-anonymizers</member>
          <member>questionable</member>
          <member>reference-and-research</member>
          <member>search-engines</member>
          <member>social-networking</member>
          <member>swimsuits-and-intimate-apparel</member>
          <member>unknown</member>
          <member>weapons</member>
          <member>web-advertisements</member>
        </block>
      </entry>

  - name: profile_group
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/profile-group
    element: |
      <entry name="Non Safe Search">
        <virus>
          <member>Outbound-AV</member>
        </virus>
        <spyware>
          <member>Outbound-AS</member>
        </spyware>
        <vulnerability>
          <member>Outbound-VP</member>
        </vulnerability>
        <url-filtering>
          <member>Outbound-URL</member>
        </url-filtering>
        <file-blocking>
          <member>Outbound-FB</member>
        </file-blocking>
        <wildfire-analysis>
          <member>Outbound-WF</member>
        </wildfire-analysis>
      </entry>

  - name: security_rules
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/rulebase/security
    element: |
      <rules>
         {%- if INCLUDE_COUNTRY_BLOCK == 'yes' %}
        <entry name="Inbound Country Block">
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Untrust</member>
          </from>
          <source>
            <member>CA</member>
            <member>Cloud Platforms - Amazon</member>
            <member>Cloud Platforms - Google</member>
            <member>Cloud Platforms - Microsoft</member>
            <member>MX</member>
            <member>US</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>any</member>
          </application>
          <service>
            <member>any</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>deny</action>
          <negate-source>yes</negate-source>
          <log-setting>default</log-setting>
          <tag>
            <member>Inbound</member>
            <member>Deny</member>
          </tag>
        </entry>
        <entry name="Outbound Country Block">
          <to>
            <member>Untrust</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>CA</member>
            <member>Cloud Platforms - Amazon</member>
            <member>Cloud Platforms - Google</member>
            <member>Cloud Platforms - Microsoft</member>
            <member>MX</member>
            <member>US</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>any</member>
          </application>
          <service>
            <member>any</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>drop</action>
          <negate-destination>yes</negate-destination>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
            <member>Deny</member>
          </tag>
        </entry>
         {% endif %}
        <entry name="Block Quic">
          <to>
            <member>any</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>quic</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>deny</action>
          <log-end>no</log-end>
          <description>Block Quic to force Chrome to fallback to SSL</description>
          <tag>
            <member>Deny</member>
          </tag>
        </entry>
           {%- if SAFE_SEARCH == 'SSL_DECRYPTION' %}
        <entry name="Outbound DNS To Sanctioned Servers">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>Sanctioned DNS Servers</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
        <entry name="Outbound DNS Block">
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>deny</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
            <member>Deny</member>
          </tag>
          <rule-type>interzone</rule-type>
        </entry>
        <entry name="Outbound Web Browsing Allowed Search Engines">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>google-base</member>
            <member>ssl</member>
            <member>web-browsing</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
           {% elif SAFE_SEARCH == "DNS_PROXY" %}
        <entry name="Outbound DNS To Sanctioned Servers">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>Sanctioned DNS Servers</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
        <entry name="Outbound To FW DNS Proxy">
          <profile-setting>
            <group>
              <member>Outbound</member>
            </group>
          </profile-setting>
          <to>
            <member>Trust</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>FW - Trust</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <tag>
            <member>Outbound</member>
          </tag>
          <action>allow</action>
          <log-setting>default</log-setting>
          <rule-type>intrazone</rule-type>
          <description>Allow DNS Proxy</description>
        </entry>
        <entry name="Outbound DNS Block">
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>deny</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
            <member>Deny</member>
          </tag>
          <rule-type>interzone</rule-type>
        </entry>
        <entry name="Outbound Web Browsing Allowed Search Engines">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>google-base</member>
            <member>ssl</member>
            <member>web-browsing</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
           {% elif SAFE_SEARCH == "LOCAL_DNS_CNAME" %}
        <entry name="Outbound DNS Internal Servers">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>Untrust</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>Local DNS Servers</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
        <entry name="Inbound DNS Internal Servers">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>Trust</member>
          </to>
          <from>
            <member>Untrust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>Local DNS Servers</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Inbound</member>
          </tag>
        </entry>
        <entry name="Outbound DNS Block">
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>dns</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>deny</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
            <member>Deny</member>
          </tag>
          <rule-type>interzone</rule-type>
        </entry>
        <entry name="Outbound Web Browsing Allowed Search Engines">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>any</member>
          </category>
          <application>
            <member>google-base</member>
            <member>ssl</member>
            <member>web-browsing</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
          {% endif %}
          {%- if YOUTUBE_FILTER == "yes" %}
        <entry name="Outbound YouTube - District Approved List">
          <profile-setting>
            <group>
              <member>default</member>
            </group>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>Trust</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>YouTube - District Approved List</member>
          </category>
          <application>
            <member>youtube-base</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
        <entry name="Outbound Block YouTube">
          <profile-setting>
            <profiles>
              <url-filtering>
                <member>BlockYouTube</member>
              </url-filtering>
            </profiles>
          </profile-setting>
          <to>
            <member>any</member>
          </to>
          <from>
            <member>any</member>
          </from>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <category>
            <member>YouTubeWatch</member>
          </category>
          <application>
            <member>youtube-base</member>
          </application>
          <service>
            <member>application-default</member>
          </service>
          <hip-profiles>
            <member>any</member>
          </hip-profiles>
          <action>allow</action>
          <log-setting>default</log-setting>
          <tag>
            <member>Outbound</member>
          </tag>
        </entry>
          {% endif %}
      </rules>

  - name: decryption_rules
    xpath: /config/devices/entry[@name='localhost.localdomain']/vsys/entry[@name='vsys1']/rulebase/decryption
    element: |
      <rules>
          <entry name="NO-Decrypt Critical_Education_Sites" uuid="1d316f9d-d319-40a5-beaf-8714ed113a7d">
          <category>
            <member>Critical_Education_Sites</member>
          </category>
          <service>
            <member>any</member>
          </service>
          <type>
            <ssl-forward-proxy/>
          </type>
          <from>
            <member>Trust</member>
          </from>
          <to>
            <member>Untrust</member>
          </to>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <action>no-decrypt</action>
        </entry>
          {%- if SAFE_SEARCH == "SSL_DECRYPTION" %}
        <entry name="Decrypt For Safe Search">
          <category>
            <member>Approved Search Engines</member>
          </category>
          <service>
            <member>any</member>
          </service>
          <type>
            <ssl-forward-proxy/>
          </type>
          <from>
            <member>any</member>
          </from>
          <to>
            <member>Untrust</member>
          </to>
          <source>
            <member>any</member>
          </source>
          <destination>
            <member>any</member>
          </destination>
          <source-user>
            <member>any</member>
          </source-user>
          <action>decrypt</action>
          <profile>default</profile>
          <disabled>yes</disabled>
        </entry>
          {% endif %}
      </rules>

  - name: response_page
    xpath: /config/shared/response-page
    element: |
      <safe-search-block-page>PGh0bWw+DQoNCiAgPGhlYWQ+DQoNCiAgICA8dGl0bGU+U2VhcmNoIEJsb2NrZWQ8L3RpdGxlPg0K
      DQogICAgPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7
      IGNoYXJzZXQ9dXRmLTgiPg0KDQogICAgPG1ldGEgaHR0cC1lcXVpdj0icHJhZ21hIiBjb250ZW50
      PSJuby1jYWNoZSI+DQoNCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0iaW5pdGlh
      bC1zY2FsZT0xLjAiPg0KDQogICAgPHN0eWxlPg0KDQogICAgICAjY29udGVudCB7DQoNCiAgICAg
      IGJvcmRlcjozcHggc29saWQjYWFhOw0KDQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7DQoN
      CiAgICAgIG1hcmdpbjoxLjVlbTsNCg0KICAgICAgcGFkZGluZzoxLjVlbTsNCg0KICAgICAgZm9u
      dC1mYW1pbHk6VGFob21hLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmOw0KDQogICAgICBmb250
      LXNpemU6MWVtOw0KDQogICAgICB9DQoNCiAgICAgIGgxIHsNCg0KICAgICAgZm9udC1zaXplOjEu
      M2VtOw0KDQogICAgICBmb250LXdlaWdodDpib2xkOw0KDQogICAgICBjb2xvcjojMTk2MzkwOw0K
      DQogICAgICB9DQoNCiAgICAgIGIgew0KDQogICAgICBmb250LXdlaWdodDpub3JtYWw7DQoNCiAg
      ICAgIGNvbG9yOiMxOTYzOTA7DQoNCiAgICAgIH0NCg0KICAgIDwvc3R5bGU+DQoNCiAgPC9oZWFk
      Pg0KDQogIDxib2R5IGJnY29sb3I9IiNlN2U4ZTkiPg0KDQogICAgPGRpdiBpZD0iY29udGVudCI+
      DQoNCiAgICAgIDxoMT5TZWFyY2ggQmxvY2tlZDwvaDE+DQoNCiAgICAgIDxwPg0KDQogICAgICAg
      IDxiPlVzZXI6PC9iPiANCg0KICAgICAgICA8dXNlci8+DQoNCiAgICAgIDwvcD4NCg0KICAgICAg
      PHA+WW91ciBzZWFyY2ggcmVzdWx0cyBoYXZlIGJlZW4gYmxvY2tlZCBiZWNhdXNlIHlvdXIgc2Vh
      cmNoIHNldHRpbmdzIGFyZSBub3QgaW4gYWNjb3JkYW5jZSB3aXRoIGNvbXBhbnkgcG9saWN5LiAg
      SW4gb3JkZXIgdG8gY29udGludWUsIHBsZWFzZSB1cGRhdGUgeW91ciBzZWFyY2ggc2V0dGluZ3Mg
      c28gdGhhdCBTYWZlIFNlYXJjaCBpcyBzZXQgdG8gdGhlIHN0cmljdGVzdCBzZXR0aW5nLiBJZiB5
      b3UgYXJlIGN1cnJlbnRseSBsb2dnZWQgaW50byB5b3VyIGFjY291bnQsIHBsZWFzZSBhbHNvIGxv
      Y2sgU2FmZSBTZWFyY2ggYW5kIHRyeSB5b3VyIHNlYXJjaCBhZ2Fpbi48L3A+DQoNCiAgICAgIDxw
      Pg0KDQogICAgICAgIEZvciBtb3JlIGluZm9ybWF0aW9uLCBwbGVhc2UgcmVmZXIgdG86IA0KDQog
      ICAgICAgIDxhIGhyZWY9Ijxzc3VybC8+Ij4NCg0KICAgICAgICAgIDxzc3VybC8+DQoNCiAgICAg
      ICAgPC9hPg0KDQogICAgICA8L3A+DQoNCiAgICAgIDxwIGlkPSJqYXZhX29mZiI+IFBsZWFzZSBl
      bmFibGUgSmF2YVNjcmlwdCBpbiB5b3VyIGJyb3dzZXIuPGJyPjwvcD4NCg0KICAgICAgPHA+PGI+
      UGxlYXNlIGNvbnRhY3QgeW91ciBzeXN0ZW0gYWRtaW5pc3RyYXRvciBpZiB5b3UgYmVsaWV2ZSB0
      aGlzIG1lc3NhZ2UgaXMgaW4gZXJyb3IuPC9iPjwvcD4NCg0KICAgIDwvZGl2Pg0KDQogIDwvYm9k
      eT4NCg0KICA8c2NyaXB0Pg0KDQogICAgLy8gR3JhYiB0aGUgVVJMIHRoYXQncyBpbiB0aGUgYnJv
      d3Nlci4NCg0KICAgIHZhciBzX3UgPSBsb2NhdGlvbi5ocmVmOw0KDQogICAgDQoNCiAgICAvL2Jp
      bmcNCg0KICAgIA0KDQogICAgLy8gTWF0Y2hlcyB0aGUgZm9yd2FyZCBzbGFzaGVzIGluIHRoZSBi
      ZWdpbm5pbmcsIGFueXRoaW5nLCB0aGVuICIuYmluZy4iIHRoZW4gYW55dGhpbmcgZm9sbG93ZWQg
      YnkgYSBub24gZ3JlZWR5IHNsYXNoLiBIb3BlZnVsbHkgdGhlIGZpcnN0IGZvcndhcmQgc2xhc2gu
      DQoNCiAgICANCg0KICAgIHZhciBiX2EgPSAvXi4qXC9cLyguK1wuYmluZ1wuLis/KVwvLy5leGVj
      KHNfdSk7DQoNCiAgICANCg0KICAgIGlmIChiX2EpIHsNCg0KICAgICAgICBzX3UgPSBzX3UgKyAi
      JmFkbHQ9c3RyaWN0IjsNCg0KICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShzX3UpOw0K
      DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJqYXZhX29mZiIpLmlubmVySFRNTCA9
      ICdZb3UgYXJlIGJlaW5nIHJlZGlyZWN0ZWQgdG8gYSBzYWZlciBzZWFyY2ghJzsNCg0KICAgIH0N
      Cg0KICAgIA0KDQogICAgLy9nb29nbGUNCg0KICAgIA0KDQogICAgLy8gTWF0Y2hlcyB0aGUgZm9y
      d2FyZCBzbGFzaGVzIGluIHRoZSBiZWdpbm5pbmcsIGFueXRoaW5nLCB0aGVuICIuZ29vZ2xlLiIg
      dGhlbiBhbnl0aGluZyBmb2xsb3dlZCBieSBhIG5vbiBncmVlZHkgc2xhc2guIEhvcGVmdWxseSB0
      aGUgZmlyc3QgZm9yd2FyZCBzbGFzaC4NCg0KICAgIA0KDQogICAgdmFyIGdfYSA9IC9eLipcL1wv
      KC4rXC5nb29nbGVcLi4rPylcLy8uZXhlYyhzX3UpOw0KDQogICAgDQoNCiAgICBpZiAoZ19hKSB7
      DQoNCiAgICAgICAgc191ID0gc191LnJlcGxhY2UoLyZzYWZlPW9mZi9pZywiIik7DQoNCiAgICAg
      ICAgc191ID0gc191ICsgIiZzYWZlPWFjdGl2ZSI7DQoNCiAgICAgICAgd2luZG93LmxvY2F0aW9u
      LnJlcGxhY2Uoc191KTsNCg0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiamF2YV9v
      ZmYiKS5pbm5lckhUTUwgPSAnWW91IGFyZSBiZWluZyByZWRpcmVjdGVkIHRvIGEgc2FmZXIgc2Vh
      cmNoISc7DQoNCiAgICB9DQoNCiAgICANCg0KICAgIC8veWFob28NCg0KICAgIA0KDQogICAgLy8g
      TWF0Y2hlcyB0aGUgZm9yd2FyZCBzbGFzaGVzIGluIHRoZSBiZWdpbm5pbmcsIGFueXRoaW5nLCB0
      aGVuICIueWFob28uIiIgdGhlbiBhbnl0aGluZyBmb2xsb3dlZCBieSBhIG5vbiBncmVlZHkgc2xh
      c2guIEhvcGVmdWxseSB0aGUgZmlyc3QgZm9yd2FyZCBzbGFzaC4NCg0KICAgIA0KDQogICAgdmFy
      IHlfYSA9IC9eLipcL1wvKC4rXC55YWhvb1wuLis/KVwvLy5leGVjKHNfdSk7DQoNCiAgICANCg0K
      ICAgIGlmICh5X2EpIHsNCg0KICAgICAgICBzX3UgPSBzX3UucmVwbGFjZSgvJnZtPXAvaWcsIiIp
      Ow0KDQogICAgICAgIHNfdSA9IHNfdSArICImdm09ciI7DQoNCiAgICAgICAgd2luZG93LmxvY2F0
      aW9uLnJlcGxhY2Uoc191KTsNCg0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiamF2
      YV9vZmYiKS5pbm5lckhUTUwgPSAnWW91IGFyZSBiZWluZyByZWRpcmVjdGVkIHRvIGEgc2FmZXIg
      c2VhcmNoISc7DQoNCiAgICB9DQoNCiAgICANCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlk
      KCJqYXZhX29mZiIpLmlubmVySFRNTCA9ICcgJzsNCg0KICA8L3NjcmlwdD4NCg0KPC9odG1sPg==
      </safe-search-block-page>

  - name: reports
    xpath: /config/shared/reports
    element: |
      <entry name="SLED-Wildfire verdicts SMTP">
        <period>last-7-calendar-days</period>
        <topn>50</topn>
        <topm>10</topm>
        <caption>SLED-Wildfire verdicts SMTP</caption>
        <query>(app eq smtp) and (category neq benign)</query>
        <description>Links sent from emails found to be malicious. </description>
        <type>
          <wildfire>
            <sortby>repeatcnt</sortby>
            <aggregate-by>
              <member>filedigest</member>
              <member>container-of-app</member>
              <member>app</member>
              <member>category</member>
              <member>filetype</member>
              <member>rule</member>
              <member>subject</member>
              <member>sender</member>
              <member>recipient</member>
              <member>misc</member>
            </aggregate-by>
          </wildfire>
        </type>
      </entry>
      <entry name="SLED-Clients sinkholed">
        <period>last-7-calendar-days</period>
        <topn>50</topn>
        <topm>50</topm>
        <caption>SLED-Clients sinkholed</caption>
        <query>(rule eq 'DNS Sinkhole Block')</query>
        <type>
          <traffic>
            <sortby>repeatcnt</sortby>
            <group-by>from</group-by>
            <aggregate-by>
              <member>src</member>
              <member>srcuser</member>
            </aggregate-by>
            <values>
              <member>repeatcnt</member>
            </values>
          </traffic>
        </type>
      </entry>

      <entry name="SLED_Threat_Log">
        <type>
          <threat>
            <aggregate-by>
              <member>action</member>
              <member>category-of-app</member>
              <member>app</member>
              <member>dst</member>
              <member>dstloc</member>
              <member>device_name</member>
              <member>srcuser</member>
            </aggregate-by>
          </threat>
        </type>
        <period>last-7-calendar-days</period>
        <topn>10</topn>
        <topm>10</topm>
        <caption>SLED_Threat_Log</caption>
      </entry>

